

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Secretary Dashboard</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f5f7fa; }
        h1 { color: #2c3e50; }

        /* Action buttons */
        .actions { margin-bottom: 20px; }
        .actions a {
            display: inline-block; margin-right: 15px; padding: 10px 15px;
            background-color: #3498db; color: white; text-decoration: none; border-radius: 6px; cursor: pointer;
        }
        .actions a:hover { background-color: #2980b9; }

        /* Filter section */
        .filter {
            margin-bottom: 20px; padding: 10px; background: #fff; border-radius: 6px;
            display: flex; gap: 10px; align-items: center; flex-wrap: wrap;
        }
        .filter input, .filter select, .filter button {
            padding: 6px 10px; border-radius: 4px; border: 1px solid #ccc;
        }
        .filter button { background-color: #3498db; color: white; border: none; cursor: pointer; }
        .filter button:hover { background-color: #2980b9; }

        /* Table */
        table { width: 100%; border-collapse: collapse; margin-top: 15px; background: white; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        th { background-color: #3498db; color: white; }
        tr:nth-child(even) { background-color: #f2f2f2; }
        .status-accepted { color: green; font-weight: bold; }
        .status-waiting { color: red; font-weight: bold; }
        .status-done { color: gray; font-weight: bold; }

        /* Action buttons inside table */
        .accept-button, .remove-button, .done-button, .get-lr-button {
            padding: 8px 14px; border: none; border-radius: 6px; cursor: pointer;
            font-weight: bold; transition: all 0.2s ease; box-shadow: 0 2px 4px rgba(0,0,0,0.15);
        }
        .accept-button { background-color: #28a745; color: white; }
        .accept-button:hover { background-color: #218838; transform: translateY(-2px); }
        .remove-button { background-color: #e74c3c; color: white; }
        .remove-button:hover { background-color: #c0392b; transform: translateY(-2px); }
        .done-button { background-color: #2e7d32; color: white; }
        .done-button:hover { background-color: #1b5e20; transform: translateY(-2px); }
        .get-lr-button { background-color: #007bff; color: white; }
        .get-lr-button:hover { background-color: #0069d9; transform: translateY(-2px); }
    </style>
</head>
<body>
<h1>Secretary Dashboard</h1>

<div class="actions">
    <a onclick="openRegisterModal()">‚ûï Register New Patient</a>
    <a href="{% url 'secretary:accept_existing_patient' %}">‚úÖ Accept Existing Patient by ID</a>
    <a href="{% url 'secretary:get_patient_last_refraction_t2' %}">üëÅ Get Patient Last Refraction</a>
</div>

<!-- Filter Form -->
<div class="filter">
    <form id="filter-form" method="GET">
        <label>Start Date:</label>
        <input type="date" name="start_date" value="{{ request.GET.start_date }}">
        <label>End Date:</label>
        <input type="date" name="end_date" value="{{ request.GET.end_date }}">
        <label>Status:</label>
        <select name="status">
            <option value="">All</option>
            <option value="waiting" {% if request.GET.status == 'waiting' %}selected{% endif %}>Waiting</option>
            <option value="accepted" {% if request.GET.status == 'accepted' %}selected{% endif %}>Accepted</option>
            <option value="done" {% if request.GET.status == 'done' %}selected{% endif %}>Done</option>
        </select>
        <label><input type="checkbox" name="keep_dismissed" {% if request.GET.keep_dismissed %}checked{% endif %}> Keep Dismissed Visible</label>
        <button type="submit">Apply Filter</button>
    </form>
</div>

<!-- Patients Table -->
<h2>All Patients</h2>
<div id="patients-table">
    {% include "secretary/patients_table.html" %}
</div>

<!-- Register Patient Modal -->
{% include "secretary/register_patient_modal.html" %}

<script>
    function openRegisterModal() {
        document.getElementById("registerModal").style.display = "flex";
        document.getElementById("registerModal").setAttribute("aria-hidden", "false");
        document.getElementById("rp_name").focus();
    }
    function closeRegisterModal() {
        document.getElementById("registerModal").style.display = "none";
        document.getElementById("registerModal").setAttribute("aria-hidden", "true");
        const err = document.getElementById("formError");
        err.textContent = ""; err.style.display = "none";
        document.getElementById("registerForm").reset();
    }

    // --- Dismiss rows JavaScript ---
    document.addEventListener('DOMContentLoaded', function() {
        const dismissedRowsKey = 'dismissedPatients';
        let dismissedRows = JSON.parse(localStorage.getItem(dismissedRowsKey) || '[]');

        // Hide previously dismissed rows
        dismissedRows.forEach(id => {
            const row = document.getElementById(`patient-${id}`);
            if (row) row.style.display = 'none';
        });

        // Attach dismiss button click
        const dismissButtons = document.querySelectorAll('.dismiss-button');
        dismissButtons.forEach(btn => {
            btn.addEventListener('click', function() {
                const patientId = this.getAttribute('data-patient-id');
                const row = document.getElementById(`patient-${patientId}`);
                if (row) row.style.display = 'none';

                if (!dismissedRows.includes(patientId)) {
                    dismissedRows.push(patientId);
                    localStorage.setItem(dismissedRowsKey, JSON.stringify(dismissedRows));
                }
            });
        });

        // Checkbox toggle
        const checkbox = document.querySelector('input[name="keep_dismissed"]');
        if (checkbox) {
            checkbox.addEventListener('change', function() {
                if (this.checked) {
                    // Show all dismissed rows
                    dismissedRows.forEach(id => {
                        const row = document.getElementById(`patient-${id}`);
                        if (row) row.style.display = '';
                    });
                } else {
                    // Hide all dismissed rows
                    dismissedRows.forEach(id => {
                        const row = document.getElementById(`patient-${id}`);
                        if (row) row.style.display = 'none';
                    });
                }
            });
        }
    });
</script>
</body>
</html>
